@model Contract_Monthly_Claim_System.Models.Claim
@{
    ViewData["Title"] = "Submit Claim";
}

<div class="container mt-5">
    <h2 class="mb-4">Submit Claim</h2>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success">@TempData["Message"]</div>
    }

    <form asp-controller="Home" asp-action="SubmitClaim" id="claimForm" method="post" enctype="multipart/form-data" novalidate>
        @* Option A: hardcoded lecturer id (no login) *@
        <input type="hidden" name="LecturerId" value="1" />

        <div class="form-group mb-3">
            <label class="form-label" for="hoursWorked">Hours Worked</label>
            <input asp-for="HoursWorked" id="hoursWorked" name="HoursWorked" type="number" step="0.01" min="0" class="form-control" placeholder="Enter total hours" required />
            <span asp-validation-for="HoursWorked" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label class="form-label" for="hourlyRate">Hourly Rate (R)</label>
            <input asp-for="HourlyRate" id="hourlyRate" name="HourlyRate" type="number" step="0.01" min="0" class="form-control" placeholder="Enter hourly rate" required />
            <span asp-validation-for="HourlyRate" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label class="form-label" for="totalAmount">Total Amount (Auto)</label>
            <input id="totalAmount" class="form-control" readonly />
        </div>

        <div class="form-group mb-3">
            <label class="form-label" for="SupportingDocument">Supporting Document</label>
            <input id="SupportingDocument" name="SupportingDocument" type="file" class="form-control" accept=".pdf,.docx,.xlsx" />
        </div>

        <button type="submit" class="btn btn-success">Submit Claim</button>
    </form>

    <div id="claimResult" class="mt-3 text-success fw-bold"></div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Auto-calc script
        document.addEventListener("DOMContentLoaded", () => {
            const hours = document.getElementById("hoursWorked");
            const rate = document.getElementById("hourlyRate");
            const total = document.getElementById("totalAmount");
            const form = document.getElementById("claimForm");
            const resultDiv = document.getElementById("claimResult");

            function calculate() {
                const h = parseFloat(hours.value) || 0;
                const r = parseFloat(rate.value) || 0;
                total.value = (h * r).toFixed(2);
            }

            hours?.addEventListener("input", calculate);
            rate?.addEventListener("input", calculate);

            // Keep progressive enhancement: capture submit to show message and allow regular post
            form?.addEventListener("submit", (e) => {
                // allow normal form submit to controller (server-side will handle)
                // but show a small client-side validation visual
                if (!hours.value || !rate.value) {
                    e.preventDefault();
                    resultDiv.textContent = "Please enter hours and hourly rate.";
                    resultDiv.classList.remove("text-success");
                    resultDiv.classList.add("text-danger");
                    return;
                }
                // show spinner / feedback (optional)
                resultDiv.textContent = "Submitting claim...";
                resultDiv.classList.remove("text-danger");
                resultDiv.classList.add("text-success");
            });
        });
    </script>
}
